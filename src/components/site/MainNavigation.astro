---
import { Menu, PanelTopClose } from 'lucide-astro';
import { getUrlPathParts } from '../../lib';
import type { LinkT } from '../../lib/types';
import { NavigationPanelBreakpoint, NavigationPanelDirection } from '../../scripts/consts';
import NavigationLink from '../moonlight/NavigationLink.astro';
import NavigationPanel from './NavigationPanel.astro';
import NavigationToggle from './NavigationToggle.astro';
import ThemeModeToggle from './ThemeModeToggle.astro';

const navLinks: ReadonlyArray<LinkT> = [
  { url: '/', title: 'Home' },
  { url: '/projects/', title: 'Projects' },
  { url: '/til/', title: 'TIL' },
  { url: '/tags/', title: 'Tags' },
  { url: '/about/', title: 'About' },
];

const urlPathParts = getUrlPathParts(Astro.url);
const navLinksSelectedLookup = navLinks.map(
  (link, i) => (urlPathParts.length === 0 && i == 0) || urlPathParts[0] === link.url.replaceAll('/', '')
);
---

<NavigationToggle
  navId="main-navigation"
  breakpoint={NavigationPanelBreakpoint.MD}
  class="absolute inline-block top-6 right-6 z-50"
  isAbsolute={true}
  CloseIcon={PanelTopClose}
  OpenIcon={Menu}
/>

<NavigationPanel
  navId="main-navigation"
  breakpoint={NavigationPanelBreakpoint.MD}
  panelDir={NavigationPanelDirection.TOP}
  class="main-navigation w-full h-full md:h-auto pr-0 md:pr-6 pt-20 md:pt-0 md:mt-0 hidden md:block fixed md:relative font-sans bg-color-bg-light dark:bg-color-bg-dark md:bg-transparent dark:md:bg-transparent"
>
  <nav class="nav-links flex flex-col md:flex-row md:justify-end">
    {
      navLinks.map((link, idx) => (
        <NavigationLink url={link.url} title={link.title} selected={!!navLinksSelectedLookup[idx]} />
      ))
    }
    <ThemeModeToggle navId="theme-mode-toggle-main-nav" initLightMode={true} class="block md:hidden my-12 mx-auto" />
  </nav>
</NavigationPanel>

<style is:global>
  .main-navigation .nav-links a,
  .main-navigation .nav-links a:visited {
    @apply block md:inline-block min-w-[8rem] mx-[0.025rem] p-[0.4rem] text-center border-gray-400 dark:border-gray-500 border border-t-0 border-l-0 border-r-0 md:border-l text-kdd-link bg-kdd md:bg-kdd-nav;
  }
  .main-navigation .nav-links a.nav-link:first-of-type {
    @apply border-t md:border-t-0;
  }
  .main-navigation .nav-links a.nav-link:last-of-type {
    @apply md:border-r;
  }
  .main-navigation .nav-links a.selected,
  .main-navigation .nav-links a:hover {
    @apply bg-konker-flash-blue-dark dark:bg-konker-flash-blue-dark text-white dark:text-white no-underline;
  }
</style>
