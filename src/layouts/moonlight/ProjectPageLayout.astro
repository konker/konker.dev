---
import type { MarkdownHeading, MarkdownInstance } from 'astro';
import type { CollectionEntry } from 'astro:content';
import { PanelLeftClose, PanelLeftOpen, PilcrowLeft, PilcrowRight } from 'lucide-astro';
import ContentNavigation from '../../components/moonlight/ContentNavigation.astro';
import IntraPageNavigation from '../../components/moonlight/IntraPageNavigation.astro';
import PageContent from '../../components/moonlight/PageContent.astro';
import NavigationToggle from '../../components/site/NavigationToggle.astro';
import type { MoonlightCollection } from '../../lib/moonlight/config';
import type { LinkT } from '../../lib/types';
import { NavigationPanelBreakpoint } from '../../scripts/consts';
import BaseLayout from '../site/BaseLayout.astro';

interface Props {
  readonly pageTitle: string;
  readonly breadcrumbs?: ReadonlyArray<LinkT> | undefined;
  readonly headings: Array<MarkdownHeading>;
  readonly Content: MarkdownInstance<object>['Content']; // AstroComponentFactory;
  readonly prevEntry: CollectionEntry<MoonlightCollection> | undefined;
  readonly nextEntry: CollectionEntry<MoonlightCollection> | undefined;
  readonly projectRootEntry: CollectionEntry<MoonlightCollection>;
  readonly projectEntries: Array<CollectionEntry<MoonlightCollection>>;
}

const { pageTitle, breadcrumbs, headings, Content, projectRootEntry, prevEntry, nextEntry, projectEntries } =
  Astro.props;
---

<BaseLayout pageTitle={pageTitle} breadcrumbs={breadcrumbs} fixedHeader={true}>
  <Fragment slot="secondary-navigation">
    <NavigationToggle
      navId="content-navigation"
      breakpoint={NavigationPanelBreakpoint.MD}
      class="flex-shrink pl-3"
      isAbsolute={false}
      CloseIcon={PanelLeftClose}
      OpenIcon={PanelLeftOpen}
    />
    <NavigationToggle
      navId="intra-page-navigation"
      breakpoint={NavigationPanelBreakpoint.LG}
      class="flex-shrink mr-6"
      isAbsolute={false}
      CloseIcon={PilcrowRight}
      OpenIcon={PilcrowLeft}
    />
  </Fragment>

  <ContentNavigation projectEntries={projectEntries} projectRootEntry={projectRootEntry} />
  <PageContent Content={Content} prevEntry={prevEntry} nextEntry={nextEntry} />
  <IntraPageNavigation headings={headings} />
  <script is:inline>
    // --------------------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
      navigationOverviewLinksInit('overview-link');
    });
  </script>
</BaseLayout>
